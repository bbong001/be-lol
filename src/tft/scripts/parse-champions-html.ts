import { NestFactory } from '@nestjs/core';
import { AppModule } from '../../app.module';
import { TftCrawlerService } from '../services/tft-crawler.service';
import * as fs from 'fs';
import * as path from 'path';

/**
 * Script to parse TFT champions from HTML
 * 
 * Usage:
 * npx ts-node -r tsconfig-paths/register src/tft/scripts/parse-champions-html.ts
 */
async function bootstrap() {
  // This is the HTML content provided in the prompt
  const htmlContent = `<div class="characters-list"><a href="/champions/alistar/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Alistar" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Alistar.png"></div><p class="character-name">Alistar</p></a><a href="/champions/annie/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Annie" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Annie.png"></div><p class="character-name">Annie</p></a><a href="/champions/aphelios/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Aphelios" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Aphelios.png"></div><p class="character-name">Aphelios</p></a><a href="/champions/aurora/" class="characters-item c5 s14"><div class="character-wrapper"><img alt="Aurora" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Aurora.png"></div><p class="character-name">Aurora</p></a><a href="/champions/brand/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Brand" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Brand.png"></div><p class="character-name">Brand</p></a><a href="/champions/braum/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Braum" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Braum.png"></div><p class="character-name">Braum</p></a><a href="/champions/chogath/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Chogath" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Chogath.png"></div><p class="character-name">Chogath</p></a><a href="/champions/darius/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Darius" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Darius.png"></div><p class="character-name">Darius</p></a><a href="/champions/dr_mundo/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Dr Mundo" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/DrMundo.png"></div><p class="character-name">Dr Mundo</p></a><a href="/champions/draven/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Draven" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Draven.png"></div><p class="character-name">Draven</p></a><a href="/champions/ekko/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Ekko" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Ekko.png"></div><p class="character-name">Ekko</p></a><a href="/champions/elise/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Elise" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Elise.png"></div><p class="character-name">Elise</p></a><a href="/champions/fiddlesticks/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Fiddlesticks" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Fiddlesticks.png"></div><p class="character-name">Fiddlesticks</p></a><a href="/champions/galio/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Galio" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Galio.png"></div><p class="character-name">Galio</p></a><a href="/champions/garen/" class="characters-item c5 s14"><div class="character-wrapper"><img alt="Garen" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Garen.png"></div><p class="character-name">Garen</p></a><a href="/champions/gragas/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Gragas" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Gragas.png"></div><p class="character-name">Gragas</p></a><a href="/champions/graves/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Graves" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Graves.png"></div><p class="character-name">Graves</p></a><a href="/champions/illaoi/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Illaoi" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Illaoi.png"></div><p class="character-name">Illaoi</p></a><a href="/champions/jarvan_iv/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Jarvan IV" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/JarvanIV.png"></div><p class="character-name">Jarvan IV</p></a><a href="/champions/jax/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Jax" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Jax.png"></div><p class="character-name">Jax</p></a><a href="/champions/jhin/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Jhin" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Jhin.png"></div><p class="character-name">Jhin</p></a><a href="/champions/jinx/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Jinx" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Jinx.png"></div><p class="character-name">Jinx</p></a><a href="/champions/kindred/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Kindred" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Kindred.png"></div><p class="character-name">Kindred</p></a><a href="/champions/kobuko/" class="characters-item c5 s14"><div class="character-wrapper"><img alt="Kobuko" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Kobuko.png"></div><p class="character-name">Kobuko</p></a><a href="/champions/kogmaw/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Kogmaw" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Kogmaw.png"></div><p class="character-name">Kogmaw</p></a><a href="/champions/leblanc/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Leblanc" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Leblanc.png"></div><p class="character-name">Leblanc</p></a><a href="/champions/leona/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Leona" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Leona.png"></div><p class="character-name">Leona</p></a><a href="/champions/miss_fortune/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Miss Fortune" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/MissFortune.png"></div><p class="character-name">Miss Fortune</p></a><a href="/champions/mordekaiser/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Mordekaiser" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Mordekaiser.png"></div><p class="character-name">Mordekaiser</p></a><a href="/champions/morgana/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Morgana" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Morgana.png"></div><p class="character-name">Morgana</p></a><a href="/champions/naafiri/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Naafiri" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Naafiri.png"></div><p class="character-name">Naafiri</p></a><a href="/champions/neeko/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Neeko" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Neeko.png"></div><p class="character-name">Neeko</p></a><a href="/champions/nidalee/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Nidalee" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Nidalee.png"></div><p class="character-name">Nidalee</p></a><a href="/champions/poppy/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Poppy" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Poppy.png"></div><p class="character-name">Poppy</p></a><a href="/champions/renekton/" class="characters-item c5 s14"><div class="character-wrapper"><img alt="Renekton" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Renekton.png"></div><p class="character-name">Renekton</p></a><a href="/champions/rengar/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Rengar" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Rengar.png"></div><p class="character-name">Rengar</p></a><a href="/champions/rhaast/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Rhaast" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Rhaast.png"></div><p class="character-name">Rhaast</p></a><a href="/champions/samira/" class="characters-item c5 s14"><div class="character-wrapper"><img alt="Samira" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Samira.png"></div><p class="character-name">Samira</p></a><a href="/champions/sejuani/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Sejuani" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Sejuani.png"></div><p class="character-name">Sejuani</p></a><a href="/champions/senna/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Senna" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Senna.png"></div><p class="character-name">Senna</p></a><a href="/champions/seraphine/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Seraphine" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Seraphine.png"></div><p class="character-name">Seraphine</p></a><a href="/champions/shaco/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Shaco" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Shaco.png"></div><p class="character-name">Shaco</p></a><a href="/champions/shyvana/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Shyvana" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Shyvana.png"></div><p class="character-name">Shyvana</p></a><a href="/champions/skarner/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Skarner" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Skarner.png"></div><p class="character-name">Skarner</p></a><a href="/champions/sylas/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Sylas" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Sylas.png"></div><p class="character-name">Sylas</p></a><a href="/champions/twisted_fate/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Twisted Fate" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/TwistedFate.png"></div><p class="character-name">Twisted Fate</p></a><a href="/champions/urgot/" class="characters-item c5 s14"><div class="character-wrapper"><img alt="Urgot" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Urgot.png"></div><p class="character-name">Urgot</p></a><a href="/champions/varus/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Varus" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Varus.png"></div><p class="character-name">Varus</p></a><a href="/champions/vayne/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Vayne" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Vayne.png"></div><p class="character-name">Vayne</p></a><a href="/champions/veigar/" class="characters-item c2 s14"><div class="character-wrapper"><img alt="Veigar" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Veigar.png"></div><p class="character-name">Veigar</p></a><a href="/champions/vex/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Vex" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Vex.png"></div><p class="character-name">Vex</p></a><a href="/champions/vi/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Vi" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Vi.png"></div><p class="character-name">Vi</p></a><a href="/champions/viego/" class="characters-item c5 s14"><div class="character-wrapper"><img alt="Viego" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Viego.png"></div><p class="character-name">Viego</p></a><a href="/champions/xayah/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Xayah" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Xayah.png"></div><p class="character-name">Xayah</p></a><a href="/champions/yuumi/" class="characters-item c3 s14"><div class="character-wrapper"><img alt="Yuumi" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Yuumi.png"></div><p class="character-name">Yuumi</p></a><a href="/champions/zac/" class="characters-item c5 s14"><div class="character-wrapper"><img alt="Zac" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Zac.png"></div><p class="character-name">Zac</p></a><a href="/champions/zed/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Zed" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Zed.png"></div><p class="character-name">Zed</p></a><a href="/champions/zeri/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Zeri" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Zeri.png"></div><p class="character-name">Zeri</p></a><a href="/champions/ziggs/" class="characters-item c4 s14"><div class="character-wrapper"><img alt="Ziggs" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Ziggs.png"></div><p class="character-name">Ziggs</p></a><a href="/champions/zyra/" class="characters-item c1 s14"><div class="character-wrapper"><img alt="Zyra" class="character-icon" src="https://sunderarmor.com/characters/Skin/14/Zyra.png"></div><p class="character-name">Zyra</p></a></div>`;

  const app = await NestFactory.createApplicationContext(AppModule);
  
  try {
    const crawlerService = app.get(TftCrawlerService);
    console.log('Starting to parse TFT champions from HTML...');
    
    // Parse champions from the HTML content
    const champions = crawlerService.parseChampionsFromHtml(htmlContent);
    console.log(`Parsed ${champions.length} champions:`);
    console.table(champions.map(c => ({ 
      name: c.name, 
      cost: c.cost, 
      set: c.set, 
      imageUrl: c.imageUrl 
    })));
    
    // Save champions to JSON file
    const outputDir = path.join(__dirname, '../../../data');
    if (!fs.existsSync(outputDir)) {
      fs.mkdirSync(outputDir, { recursive: true });
    }
    
    const outputPath = path.join(outputDir, 'tft-champions.json');
    fs.writeFileSync(outputPath, JSON.stringify(champions, null, 2), 'utf8');
    console.log(`Champions saved to ${outputPath}`);
    
    // Option to save to database
    // Uncomment the line below to save to database
    // await crawlerService.saveChampionsFromHtml(htmlContent);
    // console.log('Champions saved to database successfully!');
    
  } catch (error) {
    console.error('Error during parsing:', error);
  } finally {
    await app.close();
  }
}

bootstrap(); 